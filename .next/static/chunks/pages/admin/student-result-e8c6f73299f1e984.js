(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{1275:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/student-result",function(){return s(3953)}])},3953:function(e,t,s){"use strict";s.r(t);var l=s(5893),a=s(7294),r=s(2497),n=s(6455),i=s.n(n);t.default=()=>{let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[o,m]=(0,a.useState)({class:"",section:"",year:""}),[u,x]=(0,a.useState)(!1),[h,b]=(0,a.useState)(null),[p,g]=(0,a.useState)({currentPage:1,itemsPerPage:10,totalItems:0}),f=async()=>{try{d(!0);let e="".concat(r.Z,"/api/student-results");(o.class||o.section||o.year)&&(e="".concat(r.Z,"/api/student-results/by-class-year?class=").concat(o.class,"&section=").concat(o.section,"&year=").concat(o.year));let t=await fetch(e);if(!t.ok)throw Error("HTTP error! Status: ".concat(t.status));let s=await t.json();n(s),g(e=>({...e,totalItems:s.length}))}catch(e){console.error("Error fetching results:",e),i().fire("Error","Failed to fetch student results","error")}finally{d(!1)}};(0,a.useEffect)(()=>{f()},[o]);let j=async()=>{if(!e)return i().fire("Please select an Excel file","","warning");let s=new FormData;s.append("excel",e);try{d(!0);let e=await fetch("".concat(r.Z,"/api/student-results/upload"),{method:"POST",body:s}),l=await e.json();if(e.ok){i().fire("Success","File uploaded. ".concat(l.insertedCount||0," results saved."),"success"),t(null);let e=document.getElementById("file-input");e&&(e.value=""),f()}else i().fire("Error",l.error||"Failed to upload Excel","error")}catch(e){console.error("Upload error:",e),i().fire("Error","Something went wrong during upload","error")}finally{d(!1)}},y=async e=>{if((await i().fire({title:"Delete Result",text:"Are you sure you want to delete this result? This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{d(!0);let t=await fetch("".concat(r.Z,"/api/student-results/").concat(e),{method:"DELETE"});if(t.ok)i().fire("Deleted!","Student result has been deleted.","success"),f();else{let e=await t.json();i().fire("Error",e.error||"Failed to delete result","error")}}catch(e){console.error("Delete error:",e),i().fire("Error","Something went wrong during deletion","error")}finally{d(!1)}},N=e=>{b({...e}),x(!0)},w=e=>{let{name:t,value:s}=e.target;b(e=>({...e,[t]:s}))},v=async e=>{e.preventDefault();try{d(!0);let e={...h};if(e.publish_date){let t=new Date(e.publish_date);e.publish_date=t.toISOString().split("T")[0]}["Bangla","English","Mathematics","Science","BGS","ICT","Religion","ArtsAndCrafts","PhysicalEdu","HomeScience","AgriculturalStudies","HigherMath","Physics","Chemistry","Biology","total_marks","merit_position"].forEach(t=>{void 0!==e[t]&&null!==e[t]&&""!==e[t]&&(e[t]=Number(e[t]))});let t=await fetch("".concat(r.Z,"/api/student-results/").concat(h.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok)i().fire("Updated!","Student result has been updated.","success"),x(!1),b(null),f();else{let e=await t.json();console.error("Update error details:",e),i().fire("Error",e.error||"Failed to update result","error")}}catch(e){console.error("Update error:",e),i().fire("Error","Something went wrong during update","error")}finally{d(!1)}},C=e=>{let{name:t,value:s}=e.target;m(e=>({...e,[t]:s}))},k=e=>{g(t=>({...t,currentPage:e}))},S=(()=>{let{currentPage:e,itemsPerPage:t}=p,l=(e-1)*t;return s.slice(l,l+t)})(),E=Math.ceil(p.totalItems/p.itemsPerPage);return(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"রেজাল্ট আপলোড করুন"}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,l.jsx)("input",{type:"file",id:"file-input",accept:".xlsx, .xls",onChange:e=>t(e.target.files[0]),className:"border rounded p-2 flex-grow"}),(0,l.jsx)("button",{onClick:j,disabled:c||!e,className:"px-4 py-2 rounded ".concat(c||!e?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"," text-white"),children:c?"আপলোড হচ্ছে...":"এক্সেল আপলোড করুন"}),(0,l.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify([{student_name:"Rahim Islam",roll:"101",class:"10",section:"A",year:"2024",Bangla:75,English:80,Mathematics:85,Science:78,BGS:82,ICT:90,Religion:88}],null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="student_results_template.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),i().fire("Template Downloaded","Please convert the JSON template to Excel format before uploading.","info")},className:"px-4 py-2 rounded bg-green-600 hover:bg-green-700 text-white",children:"নমুনা ডাউনলোড"})]}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"শিক্ষার্থী ফলাফল সহ একটি এক্সেল ফাইল আপলোড করুন। ফাইলে student_name, roll, class, section, year এবং বিষয়ভিত্তিক স্কোর অন্তর্ভুক্ত থাকতে হবে।"})]}),(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"ফলাফল অনুসন্ধান করুন"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"শ্রেণি"}),(0,l.jsx)("input",{type:"text",name:"class",value:o.class,onChange:C,placeholder:"যেমন: ১০",className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"শাখা"}),(0,l.jsx)("input",{type:"text",name:"section",value:o.section,onChange:C,placeholder:"যেমন: ক",className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"সাল"}),(0,l.jsx)("input",{type:"text",name:"year",value:o.year,onChange:C,placeholder:"যেমন: ২০২৪",className:"w-full border rounded p-2"})]}),(0,l.jsx)("div",{className:"flex items-end",children:(0,l.jsx)("button",{onClick:()=>{m({class:"",section:"",year:""})},className:"px-4 py-2 rounded bg-gray-500 hover:bg-gray-600 text-white",children:"ফিল্টার মুছুন"})})]})]}),u&&h&&(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"শিক্ষার্থী ফলাফল সম্পাদনা"}),(0,l.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"শিক্ষার্থীর নাম"}),(0,l.jsx)("input",{type:"text",name:"student_name",value:h.student_name||"",onChange:w,className:"w-full border rounded p-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"রোল"}),(0,l.jsx)("input",{type:"text",name:"roll",value:h.roll||"",onChange:w,className:"w-full border rounded p-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"শ্রেণি"}),(0,l.jsx)("input",{type:"text",name:"class",value:h.class||"",onChange:w,className:"w-full border rounded p-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"শাখা"}),(0,l.jsx)("input",{type:"text",name:"section",value:h.section||"",onChange:w,className:"w-full border rounded p-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"সাল"}),(0,l.jsx)("input",{type:"text",name:"year",value:h.year||"",onChange:w,className:"w-full border rounded p-2",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"বাংলা"}),(0,l.jsx)("input",{type:"number",name:"Bangla",value:h.Bangla||"",onChange:w,className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ইংরেজি"}),(0,l.jsx)("input",{type:"number",name:"English",value:h.English||"",onChange:w,className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"গণিত"}),(0,l.jsx)("input",{type:"number",name:"Mathematics",value:h.Mathematics||"",onChange:w,className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"বিজ্ঞান"}),(0,l.jsx)("input",{type:"number",name:"Science",value:h.Science||"",onChange:w,className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"বিজিএস"}),(0,l.jsx)("input",{type:"number",name:"BGS",value:h.BGS||"",onChange:w,className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"আইসিটি"}),(0,l.jsx)("input",{type:"number",name:"ICT",value:h.ICT||"",onChange:w,className:"w-full border rounded p-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ধর্ম"}),(0,l.jsx)("input",{type:"number",name:"Religion",value:h.Religion||"",onChange:w,className:"w-full border rounded p-2"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{b(null),x(!1)},className:"px-4 py-2 rounded bg-gray-500 hover:bg-gray-600 text-white",children:"বাতিল"}),(0,l.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white",children:c?"সংরক্ষণ হচ্ছে...":"সংরক্ষণ করুন"})]})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold p-4 border-b",children:"শিক্ষার্থী ফলাফল তালিকা"}),c&&!u?(0,l.jsx)("div",{className:"p-8 text-center",children:(0,l.jsx)("p",{children:"ফলাফল লোড হচ্ছে..."})}):0===s.length?(0,l.jsx)("div",{className:"p-8 text-center",children:(0,l.jsx)("p",{children:"কোনো ফলাফল পাওয়া যায়নি। একটি এক্সেল ফাইল আপলোড করুন অথবা আপনার ফিল্টার সমন্বয় করুন।"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full table-auto",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"নাম"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"রোল"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"শ্রেণি"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"শাখা"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"সাল"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"মোট নম্বর"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"মেধা অবস্থান"}),(0,l.jsx)("th",{className:"p-3 text-left text-sm font-medium text-gray-700",children:"কার্যক্রম"})]})}),(0,l.jsx)("tbody",{children:S.map(e=>(0,l.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"p-3",children:e.student_name}),(0,l.jsx)("td",{className:"p-3",children:e.roll}),(0,l.jsx)("td",{className:"p-3",children:e.class}),(0,l.jsx)("td",{className:"p-3",children:e.section}),(0,l.jsx)("td",{className:"p-3",children:e.year}),(0,l.jsx)("td",{className:"p-3",children:e.total_marks}),(0,l.jsx)("td",{className:"p-3",children:e.merit_position}),(0,l.jsxs)("td",{className:"p-3 space-x-2",children:[(0,l.jsx)("button",{onClick:()=>N(e),className:"text-blue-600 hover:underline",children:"সম্পাদনা"}),(0,l.jsx)("button",{onClick:()=>y(e.id),className:"text-red-600 hover:underline",children:"মুছুন"})]})]},e.id))})]})}),E>1&&(0,l.jsx)("div",{className:"flex justify-center p-4 border-t",children:(0,l.jsxs)("nav",{className:"inline-flex",children:[(0,l.jsx)("button",{onClick:()=>k(1),disabled:1===p.currentPage,className:"px-3 py-1 rounded-l-md border ".concat(1===p.currentPage?"bg-gray-100 text-gray-400":"bg-white hover:bg-gray-50"),children:"প্রথম"}),[...Array(E).keys()].map(e=>(0,l.jsx)("button",{onClick:()=>k(e+1),className:"px-3 py-1 border-t border-b ".concat(p.currentPage===e+1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"),children:e+1},e)),(0,l.jsx)("button",{onClick:()=>k(E),disabled:p.currentPage===E,className:"px-3 py-1 rounded-r-md border ".concat(p.currentPage===E?"bg-gray-100 text-gray-400":"bg-white hover:bg-gray-50"),children:"শেষ"})]})})]})]})]})}}},function(e){e.O(0,[166,888,774,179],function(){return e(e.s=1275)}),_N_E=e.O()}]);
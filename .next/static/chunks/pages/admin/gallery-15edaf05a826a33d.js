(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[252],{9657:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/gallery",function(){return a(5394)}])},5394:function(e,t,a){"use strict";a.r(t);var s=a(5893),l=a(7294),r=a(2497),i=a(6455),n=a.n(i),o=a(1163),c=a(7730),d=a(5152),m=a.n(d);a(6834);var g=a(1358),x=a.n(g);let u=m()(()=>Promise.all([a.e(937),a.e(876),a.e(167)]).then(a.t.bind(a,1167,23)),{loadableGenerated:{webpack:()=>[1167]},ssr:!1});t.default=()=>{let{user:e}=(0,l.useContext)(c.S),t=(0,o.useRouter)(),[a,i]=(0,l.useState)({galleryItems:[],filteredItems:[],searchTerm:"",currentPage:0,isLoading:!1}),[d,m]=(0,l.useState)({id:null,image:null,title:"",description:"",category:""}),[g,p]=(0,l.useState)(!1),[h,y]=(0,l.useState)(null);(0,l.useEffect)(()=>{e?"headmaster"!==e.role?t.push("/unauthorized"):b():t.push("/login")},[e]);let b=async()=>{i(e=>({...e,isLoading:!0}));try{let e=await fetch("".concat(r.Z,"/api/gallery"));if(!e.ok)throw Error("Failed to fetch gallery items");let t=await e.json();i(e=>({...e,galleryItems:t,filteredItems:t,isLoading:!1}))}catch(e){n().fire("Error",e.message,"error"),i(e=>({...e,isLoading:!1}))}},f=e=>{let{name:t,value:a}=e.target;m(e=>({...e,[t]:a}))},N=async e=>{if(e.preventDefault(),!d.title||!d.category||!d.image&&!g){n().fire("Error","Please fill out all required fields","error");return}let t=new FormData;d.image&&t.append("image",d.image),t.append("title",d.title),t.append("description",d.description||""),t.append("category",d.category);try{if(!(await fetch("".concat(r.Z,"/api/gallery").concat(g?"/".concat(d.id):""),{method:g?"PUT":"POST",body:t})).ok)throw Error("Operation failed");n().fire("Success","Gallery item ".concat(g?"updated":"added"," successfully"),"success"),j(),b()}catch(e){n().fire("Error",e.message,"error")}},j=()=>{m({id:null,image:null,title:"",description:"",category:""}),p(!1),y(null)},w=e=>{m({id:e.id,image:null,title:e.title,description:e.description,category:e.category}),y("".concat(r.Z,"/").concat(e.image)),p(!0)},C=async e=>{try{if((await n().fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed){let t=await fetch("".concat(r.Z,"/api/gallery/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete gallery item")}n().fire("Deleted!","Gallery item has been deleted.","success"),b()}}catch(e){n().fire("Error",e.message,"error")}},v=a.filteredItems.slice(5*a.currentPage,(a.currentPage+1)*5);return(null==e?void 0:e.role)==="headmaster"&&(0,s.jsxs)("div",{className:"container mx-auto my-6 p-6 bg-white shadow-lg rounded-lg",children:[(0,s.jsx)("h3",{className:"text-3xl font-semibold text-slate-800 mb-6 text-center",children:"Add / Edit Gallery"}),(0,s.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"text-lg font-medium text-slate-700 mb-2",children:"Title"}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",className:"form-control w-full p-3 border rounded-lg",value:d.title,onChange:f,required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"text-lg font-medium text-slate-700 mb-2",children:"Category *"}),(0,s.jsx)("input",{type:"text",id:"category",name:"category",className:"form-control w-full p-3 border rounded-lg",value:d.category,onChange:f,required:!0})]})]}),(0,s.jsxs)("div",{className:"form-group mb-6",children:[(0,s.jsx)("label",{htmlFor:"description",className:"text-lg font-medium text-slate-700 mb-2",children:"Description"}),(0,s.jsx)(u,{value:d.description,onChange:e=>m(t=>({...t,description:e})),className:"w-full border rounded-lg"})]}),(0,s.jsxs)("div",{className:"form-group mb-6",children:[(0,s.jsxs)("label",{htmlFor:"image",className:"text-lg font-medium text-slate-700 mb-2",children:["Image ",!g&&"*"]}),(0,s.jsx)("input",{type:"file",id:"image",name:"image",accept:"image/*",className:"form-control w-full p-3 border rounded-lg",onChange:e=>{let t=e.target.files[0];if(t){if(t.size>5e6){n().fire("Error","File size should not exceed 5MB","error");return}m(e=>({...e,image:t})),y(URL.createObjectURL(t))}},required:!g}),h&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("img",{src:h,alt:"Preview",className:"max-w-[200px] max-h-[200px] object-cover border rounded-lg"})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("button",{type:"submit",className:"btn btn-primary px-6 py-2 text-white bg-blue-600 rounded-lg",children:[g?"Update":"Add"," Gallery Item"]}),g&&(0,s.jsx)("button",{type:"button",className:"btn btn-secondary px-6 py-2 text-white bg-gray-600 rounded-lg",onClick:j,children:"Cancel Edit"})]})]}),a.isLoading?(0,s.jsx)("div",{className:"text-center text-lg font-semibold text-gray-500",children:"Loading..."}):(0,s.jsxs)("div",{className:"mt-6 overflow-x-auto",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",className:"form-control w-full p-3 border rounded-lg shadow-md",placeholder:"Search by title or category",value:a.searchTerm,onChange:e=>{let t=e.target.value.toLowerCase(),s=a.galleryItems.filter(e=>{let a=e.title?e.title.toLowerCase():"",s=e.category?e.category.toLowerCase():"";return a.includes(t)||s.includes(t)});i(e=>({...e,searchTerm:t,filteredItems:s,currentPage:0}))}})}),(0,s.jsxs)("table",{className:"table-auto w-full border-collapse text-left",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-blue-100",children:[(0,s.jsx)("th",{className:"px-4 py-2 text-sm font-semibold text-gray-700",children:"#"}),(0,s.jsx)("th",{className:"px-4 py-2 text-sm font-semibold text-gray-700",children:"Image"}),(0,s.jsx)("th",{className:"px-4 py-2 text-sm font-semibold text-gray-700",children:"Title"}),(0,s.jsx)("th",{className:"px-4 py-2 text-sm font-semibold text-gray-700",children:"Category"}),(0,s.jsx)("th",{className:"px-4 py-2 text-sm font-semibold text-gray-700",children:"Description"}),(0,s.jsx)("th",{className:"px-4 py-2 text-sm font-semibold text-gray-700",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:v.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:t+1+5*a.currentPage}),(0,s.jsx)("td",{className:"px-4 py-2",children:(0,s.jsx)("img",{src:"".concat(r.Z,"/").concat(e.image),alt:e.title,className:"max-w-[100px] max-h-[100px] object-cover"})}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:e.title}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:e.category}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e.description}})}),(0,s.jsxs)("td",{className:"px-4 py-2",children:[(0,s.jsx)("button",{className:"btn btn-warning btn-sm px-4 py-2 text-white bg-yellow-600 rounded-lg",onClick:()=>w(e),children:"Edit"}),(0,s.jsx)("button",{className:"btn btn-danger btn-sm px-4 py-2 text-white bg-red-600 rounded-lg",onClick:()=>C(e.id),children:"Delete"})]})]},e.id))})]}),(0,s.jsx)(x(),{previousLabel:"Previous",nextLabel:"Next",breakLabel:"...",pageCount:Math.ceil(a.filteredItems.length/5),marginPagesDisplayed:2,pageRangeDisplayed:5,onPageChange:e=>{let{selected:t}=e;return i(e=>({...e,currentPage:t}))},containerClassName:"pagination justify-center mt-6",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]})]})}}},function(e){e.O(0,[166,414,656,888,774,179],function(){return e(e.s=9657)}),_N_E=e.O()}]);
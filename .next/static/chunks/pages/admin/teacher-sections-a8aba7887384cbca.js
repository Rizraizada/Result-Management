(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{4090:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/teacher-sections",function(){return t(9419)}])},9419:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return c}});var a=t(5893),i=t(7294),n=t(2497);function c(){let[e,s]=(0,i.useState)([]),[t,c]=(0,i.useState)([]),[r,l]=(0,i.useState)([]),[o,d]=(0,i.useState)(""),[m,h]=(0,i.useState)(""),[u,x]=(0,i.useState)({sectionId:"",isPrimary:!1}),[p,b]=(0,i.useState)(null),[g,j]=(0,i.useState)(!1),[f,y]=(0,i.useState)(""),[N,w]=(0,i.useState)(!0),[S,v]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([fetch("".concat(n.Z,"/api/auth/users")),fetch("".concat(n.Z,"/api/sections"))]),a=await e.json(),i=await t.json();if(e.ok&&t.ok){s(a.users),c(i);let e=await Promise.all(a.users.map(async e=>{let s=await fetch("".concat(n.Z,"/api/teacher-sections/").concat(e.id,"/sections")),t=s.ok?await s.json():[];return{userId:e.id,username:e.name,assignedSections:t}}));l(e)}else b("Failed to fetch initial data")}catch(e){b("Error loading data: "+e.message)}finally{w(!1)}})()},[]);let P=async e=>{if(e.preventDefault(),!o||!m){b("Please select both user and section");return}j(!0),b(null);try{let e=S?"".concat(n.Z,"/api/teacher-sections/").concat(S.id):"".concat(n.Z,"/api/teacher-sections"),s=await fetch(e,{method:S?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacherId:o,sectionId:m,isPrimary:u.isPrimary})});if(!s.ok)throw Error("Failed to assign/update section");let t=await s.json();y(t.message);let a=await fetch("".concat(n.Z,"/api/teacher-sections/").concat(o,"/sections")),i=a.ok?await a.json():[];l(e=>e.map(e=>e.userId===o?{...e,assignedSections:i}:e)),h(""),x({sectionId:"",isPrimary:!1}),v(null),setTimeout(()=>y(""),3e3)}catch(e){b("Error assigning/updating section: "+e.message)}finally{j(!1)}},k=(e,s)=>{d(e),h(s.id),x({sectionId:s.id,isPrimary:s.isPrimary}),v(s)},E=async(e,s)=>{if(confirm("Are you sure you want to remove this section assignment?"))try{let t=await fetch("".concat(n.Z,"/api/teacher-sections/").concat(s),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete section");let a=await t.json();y(a.message);let i=await fetch("".concat(n.Z,"/api/teacher-sections/").concat(e,"/sections")),c=i.ok?await i.json():[];l(s=>s.map(s=>s.userId===e?{...s,assignedSections:c}:s)),setTimeout(()=>y(""),3e3)}catch(e){b("Error deleting section: "+e.message)}};return N?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 rounded-full border-t-transparent"})}):(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-4 space-y-6",children:[p&&(0,a.jsx)("div",{className:"text-red-500 mb-4",children:p}),f&&(0,a.jsx)("div",{className:"text-green-500 mb-4",children:f}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:S?"Edit Section Assignment":"Assign Section to User"}),(0,a.jsxs)("form",{onSubmit:P,children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"user-select",className:"block text-lg font-semibold",children:"Select User:"}),(0,a.jsxs)("select",{id:"user-select",value:o,onChange:e=>{d(e.target.value)},className:"w-full p-2 border border-gray-300 mt-2",children:[(0,a.jsx)("option",{value:"",children:"Choose a user..."}),e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.username},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"section-select",className:"block text-lg font-semibold",children:"Select Section:"}),(0,a.jsxs)("select",{id:"section-select",value:m,onChange:e=>{h(e.target.value)},className:"w-full p-2 border border-gray-300 mt-2",children:[(0,a.jsx)("option",{value:"",children:"Choose a section..."}),t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.sectionName},e.id))]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isPrimary",checked:u.isPrimary,onChange:e=>x({...u,isPrimary:e.target.checked}),className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"isPrimary",children:"Set as primary section"})]}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"mt-6 w-full bg-blue-600 text-white p-2 rounded",children:g?"Saving...":S?"Update Section":"Assign Section"})]})]}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"All User Section Assignments"}),0===r.length?(0,a.jsx)("p",{children:"No assignments available"}):(0,a.jsxs)("table",{className:"w-full border-collapse bg-gray-50",children:[(0,a.jsx)("thead",{className:"bg-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 border-b text-left",children:"Section Name"}),(0,a.jsx)("th",{className:"px-4 py-2 border-b text-left",children:"Primary"}),(0,a.jsx)("th",{className:"px-4 py-2 border-b text-left",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:r.map(e=>e.assignedSections.map((s,t)=>(0,a.jsxs)("tr",{className:"".concat(t%2==0?"bg-white":"bg-gray-100"," border-t"),children:[(0,a.jsx)("td",{className:"px-4 py-2",children:s.sectionName}),(0,a.jsx)("td",{className:"px-4 py-2",children:s.isPrimary?"Yes":"No"}),(0,a.jsxs)("td",{className:"px-4 py-2 space-x-3",children:[(0,a.jsx)("button",{onClick:()=>k(e.userId,s),className:"text-blue-600 hover:text-blue-800",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>E(e.userId,s.id),className:"text-red-600 hover:text-red-800",children:"Delete"})]})]},"".concat(e.userId,"-").concat(s.id))))})]})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4090)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[337],{3706:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/section",function(){return s(2667)}])},2667:function(e,t,s){"use strict";s.r(t);var a=s(5893),n=s(7294),l=s(7730),r=s(1163),c=s(2497),i=s(6455),o=s.n(i);let d=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a={method:t,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}};s&&(a.body=JSON.stringify(s));let n=await fetch("".concat(c.Z).concat(e),a);if(!n.ok)throw Error((await n.json()).message||"Something went wrong");return n.json()},u=e=>{let[t,s]=(0,n.useState)([]),[a,l]=(0,n.useState)(!0),[r,c]=(0,n.useState)("");return(0,n.useEffect)(()=>{(null==e?void 0:e.role)==="headmaster"&&d("/api/classes").then(s).catch(e=>c(e.message)).finally(()=>l(!1))},[e]),{classes:t,loading:a,error:r}},m=e=>{let[t,s]=(0,n.useState)([]),[a,l]=(0,n.useState)(!0),[r,c]=(0,n.useState)(""),i=()=>{l(!0),d("/api/sections").then(s).catch(e=>c(e.message)).finally(()=>l(!1))};return(0,n.useEffect)(()=>{(null==e?void 0:e.role)==="headmaster"&&i()},[e]),{sections:t,fetchSections:i,loading:a,error:r}},h=e=>{let{message:t}=e;return(0,a.jsx)("div",{className:"text-red-500 p-4 border border-red-500 rounded",children:t})};t.default=()=>{let[e,t]=(0,n.useState)(""),[s,c]=(0,n.useState)(""),[i,x]=(0,n.useState)(!1),[p,f]=(0,n.useState)(null),{user:b}=(0,n.useContext)(l.S),N=(0,r.useRouter)(),{classes:j,loading:y,error:g}=u(b),{sections:S,fetchSections:w,loading:v,error:C}=m(b);(0,n.useEffect)(()=>{b?"headmaster"!==b.role&&N.push("/unauthorized"):N.push("/login")},[b,N]);let E=async t=>{if(t.preventDefault(),!e.trim()||!s){o().fire({icon:"warning",title:"Input Required",text:"Please enter all fields."});return}try{let t=i?"/api/sections/".concat(p):"/api/sections";await d(t,i?"PUT":"POST",{sectionName:e,classId:s}),o().fire({icon:"success",title:i?"Section Updated":"Section Created",text:"Section ".concat(i?"updated":"created"," successfully!")}),w(),T()}catch(e){o().fire({icon:"error",title:"Error",text:e.message})}},k=e=>{t(e.sectionName),c(e.classId),x(!0),f(e.id)},_=async e=>{try{(await o().fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed&&(await d("/api/sections/".concat(e),"DELETE"),o().fire({icon:"success",title:"Deleted",text:"Section deleted successfully!"}),w())}catch(e){o().fire({icon:"error",title:"Error",text:e.message})}},T=()=>{t(""),c(""),x(!1),f(null)};return v||y?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:"Loading..."}):(0,a.jsxs)("div",{className:"container mx-auto py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Section Management"}),C&&(0,a.jsx)(h,{message:C}),g&&(0,a.jsx)(h,{message:g}),(0,a.jsxs)("form",{onSubmit:E,className:"mb-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"sectionName",className:"block text-sm font-medium",children:"Section Name"}),(0,a.jsx)("input",{id:"sectionName",value:e,onChange:e=>t(e.target.value),placeholder:"Enter section name",className:"mt-1 px-4 py-2 border rounded w-full"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"classId",className:"block text-sm font-medium",children:"Select Class"}),(0,a.jsxs)("select",{id:"classId",value:s,onChange:e=>c(e.target.value),className:"mt-1 px-4 py-2 border rounded w-full",children:[(0,a.jsx)("option",{value:"",children:"-- Select Class --"}),j.map(e=>(0,a.jsx)("option",{value:e.id,children:e.className},e.id))]})]}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:i?"Update Section":"Create Section"}),(0,a.jsx)("button",{type:"button",onClick:T,className:"ml-2 px-4 py-2 bg-gray-300 text-black rounded",children:"Reset"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse border",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border px-4 py-2",children:"Section Name"}),(0,a.jsx)("th",{className:"border px-4 py-2",children:"Class"}),(0,a.jsx)("th",{className:"border px-4 py-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:S.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border px-4 py-2",children:e.sectionName}),(0,a.jsx)("td",{className:"border px-4 py-2",children:e.className||"N/A"}),(0,a.jsxs)("td",{className:"border px-4 py-2",children:[(0,a.jsx)("button",{onClick:()=>k(e),className:"px-3 py-1 bg-yellow-500 text-white rounded",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>_(e.id),className:"ml-2 px-3 py-1 bg-red-500 text-white rounded",children:"Delete"})]})]},e.id))})]})})]})}}},function(e){e.O(0,[166,888,774,179],function(){return e(e.s=3706)}),_N_E=e.O()}]);
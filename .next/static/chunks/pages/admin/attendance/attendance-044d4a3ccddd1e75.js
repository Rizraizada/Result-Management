(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[359],{4301:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/attendance/attendance",function(){return s(9518)}])},9518:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(5893),n=s(7294),r=s(2497),d=s(1163),l=s(7730),c=s(6455),i=s.n(c);function o(){let[e,t]=(0,n.useState)([]),[s,c]=(0,n.useState)(null),[o,u]=(0,n.useState)({}),[x,h]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null),[b,g]=(0,n.useState)(new Date().toISOString().split("T")[0]),{user:f}=(0,n.useContext)(l.S),j=(0,d.useRouter)();(0,n.useEffect)(()=>{f?"headmaster"!==f.role&&"teacher"!==f.role&&j.push("/unauthorized"):j.push("/login")},[f,j]),(0,n.useEffect)(()=>{f&&f.id&&y()},[f]);let y=async()=>{h(!0);try{let e=await fetch("".concat(r.Z,"/api/teacher-sections/").concat(f.id,"/sections")),s=await e.json();t(s)}catch(e){i().fire({icon:"error",title:"Oops...",text:"Failed to fetch sections"})}finally{h(!1)}},N=async e=>{h(!0);try{let t=await fetch("".concat(r.Z,"/api/students/sections/").concat(e,"/students")),s=await t.json(),a=await fetch("".concat(r.Z,"/api/attendance/sections/").concat(e,"/attendance")),n=await a.json()||[],d=s.map(e=>{var t,s;return{studentId:e.id,studentName:e.name,status:(null===(t=n.find(t=>t.student_id===e.id))||void 0===t?void 0:t.status)||"present",remarks:(null===(s=n.find(t=>t.student_id===e.id))||void 0===s?void 0:s.remarks)||""}});u(t=>({...t,[e]:{students:d,attendance:d}})),c(e)}catch(e){i().fire({icon:"error",title:"Error",text:"Failed to fetch students or attendance"})}finally{h(!1)}},w=(e,t)=>{u(a=>{let n=a[s].attendance.map(s=>s.studentId===e?{...s,status:t}:s);return{...a,[s]:{...a[s],attendance:n}}})},v=(e,t)=>{u(a=>{let n=a[s].attendance.map(s=>s.studentId===e?{...s,remarks:t}:s);return{...a,[s]:{...a[s],attendance:n}}})},S=async()=>{h(!0);try{if(!f||!f.id)throw Error("User not logged in");let e=o[s].attendance.map(e=>({studentId:e.studentId,attendanceDate:b,status:e.status,recordedBy:f.id,remarks:e.remarks||null}));if(!(await fetch("".concat(r.Z,"/api/attendance/bulk-record"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attendanceData:e})})).ok)throw Error("Failed to submit attendance");p({totalStudents:o[s].students.length,present:o[s].attendance.filter(e=>"present"===e.status).length,absent:o[s].attendance.filter(e=>"absent"===e.status).length,late:o[s].attendance.filter(e=>"late"===e.status).length,excused:o[s].attendance.filter(e=>"excused"===e.status).length}),i().fire({icon:"success",title:"Success",text:"Attendance recorded successfully"})}catch(e){i().fire({icon:"error",title:"Error",text:e.message})}finally{h(!1)}},k=e=>{let t="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(e){case"present":return"".concat(t," bg-green-100 text-green-800");case"absent":return"".concat(t," bg-red-100 text-red-800");case"late":return"".concat(t," bg-yellow-100 text-yellow-800");case"excused":return"".concat(t," bg-blue-100 text-blue-800");default:return"".concat(t," bg-gray-100 text-gray-800")}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"flex items-center mb-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-4 w-72",children:[(0,a.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-2 text-center",children:"Select Date"}),(0,a.jsx)("input",{type:"date",id:"date",value:b,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:e.map(e=>(0,a.jsxs)("div",{onClick:()=>N(e.section_id),className:"p-6 rounded-xl shadow-lg cursor-pointer transform hover:scale-105 transition duration-300\n                ".concat(s===e.id?"bg-blue-50 border-2 border-blue-500":"bg-white hover:bg-gray-50 border border-gray-200"),children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:[e.className," - ",e.sectionName]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)("p",{className:"text-gray-700 text-sm",children:[e.studentsCount," Students"]})})]},e.id))}),s&&o[s]&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Students"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"table-auto w-full text-left",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2",children:"Name"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Remarks"})]})}),(0,a.jsx)("tbody",{children:o[s].students.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border-t px-4 py-2",children:e.studentName}),(0,a.jsx)("td",{className:"border-t px-4 py-2",children:(0,a.jsx)("div",{className:"status-checkbox-group",children:[{value:"present",label:"Present"},{value:"absent",label:"Absent"},{value:"late",label:"Late"},{value:"excused",label:"Excused"}].map(t=>(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.status===t.value,onChange:()=>w(e.studentId,t.value),className:"rounded-md focus:ring-2 ".concat(k(e.status))}),(0,a.jsx)("span",{children:t.label})]},t.value))})}),(0,a.jsx)("td",{className:"border-t px-4 py-2",children:(0,a.jsx)("input",{type:"text",value:e.remarks,onChange:t=>v(e.studentId,t.target.value),placeholder:"Add remarks...",className:"w-full border border-gray-300 rounded-md shadow-sm px-2 py-1 focus:ring-2 focus:ring-blue-500"})})]},e.studentId))})]})}),(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsx)("button",{onClick:S,disabled:x,className:"bg-blue-600 text-white px-6 py-2 rounded-md shadow hover:bg-blue-700 transition duration-200",children:x?"Saving...":"Submit Attendance"})})]}),m&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-xl shadow-lg p-6 mt-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-green-800 mb-4",children:"Summary"}),(0,a.jsxs)("p",{children:["Total Students: ",m.totalStudents]}),(0,a.jsxs)("p",{children:["Present: ",m.present]}),(0,a.jsxs)("p",{children:["Absent: ",m.absent]}),(0,a.jsxs)("p",{children:["Late: ",m.late]}),(0,a.jsxs)("p",{children:["Excused: ",m.excused]})]})]})})}s(8215)},8215:function(){}},function(e){e.O(0,[166,802,888,774,179],function(){return e(e.s=4301)}),_N_E=e.O()}]);
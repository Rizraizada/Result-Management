(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{3090:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/attendance/quickattendence",function(){return a(523)}])},523:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var n=a(5893),s=a(7294),r=a(2497),c=a(1163),l=a(7730),d=a(6455),o=a.n(d);function i(){let[e,t]=(0,s.useState)([]),[a,d]=(0,s.useState)([]),[i,u]=(0,s.useState)(""),[m,h]=(0,s.useState)(0),[x,b]=(0,s.useState)(0),[p,f]=(0,s.useState)(new Date().toISOString().split("T")[0]),[y,g]=(0,s.useState)(""),[j,N]=(0,s.useState)(1),[w,v]=(0,s.useState)(!1),{user:C}=(0,s.useContext)(l.S),S=(0,c.useRouter)();(0,s.useEffect)(()=>{C?"headmaster"!==C.role&&"teacher"!==C.role&&S.push("/unauthorized"):S.push("/login")},[C,S]),(0,s.useEffect)(()=>{C&&C.id&&(_(),k())},[C]);let _=async()=>{v(!0);try{let e=await fetch("".concat(r.Z,"/api/teacher-sections/").concat(C.id,"/sections")),a=await e.json();t(a)}catch(e){o().fire({icon:"error",title:"Oops...",text:"Failed to fetch sections"})}finally{v(!1)}},k=async()=>{try{let e=await fetch("".concat(r.Z,"/api/quickattendance/quick")),t=await e.json();Array.isArray(t)?d(t):(console.error("Unexpected API response format:",t),d([]))}catch(e){console.error("Error fetching attendance records:",e),d([])}},E=()=>Array.isArray(a)?a.some(e=>e.section_id===i&&e.attendance_date===p):(console.error("attendanceRecords is not an array:",a),!1),A=async()=>{v(!0);try{if(!C||!C.id)throw Error("User not logged in");if(!i)throw Error("No section selected");if(0===m&&0===x)throw Error("Please enter valid male and female counts");if(E())throw Error("Attendance for this section and date has already been recorded.");let e={sectionId:i,attendanceDate:p,maleCount:m,femaleCount:x,recordedBy:C.id},t=await fetch("".concat(r.Z,"/api/quickattendance/quick"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to submit quick attendance")}o().fire({icon:"success",title:"Success",text:"Quick attendance recorded successfully"}),k()}catch(e){o().fire({icon:"error",title:"Error",text:e.message})}finally{v(!1)}},F=()=>Array.isArray(a)?a.filter(e=>!y||e.sectionName.toLowerCase().includes(y.toLowerCase())||e.attendance_date.includes(y)||e.teacher_name.toLowerCase().includes(y.toLowerCase())):[],D=F().slice((j-1)*5,5*j),P=Math.ceil(F().length/5),q=e=>{e>0&&e<=P&&N(e)};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsxs)("div",{className:"container mx-auto px-4",children:[(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-center mb-6",children:"Quick Attendance Form"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"section",className:"block text-lg font-semibold mb-2",children:"Select Section"}),(0,n.jsxs)("select",{id:"section",value:i,onChange:e=>u(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,n.jsx)("option",{value:"",children:"--Select Section--"}),e.map(e=>(0,n.jsx)("option",{value:e.section_id,children:e.sectionName},e.section_id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"attendanceDate",className:"block text-lg font-semibold mb-2",children:"Attendance Date"}),(0,n.jsx)("input",{type:"date",id:"attendanceDate",value:p,onChange:e=>f(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"maleCount",className:"block text-lg font-semibold mb-2",children:"Male Count"}),(0,n.jsx)("input",{type:"number",id:"maleCount",value:m,onChange:e=>h(e.target.value),min:"0",className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Enter male count"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"femaleCount",className:"block text-lg font-semibold mb-2",children:"Female Count"}),(0,n.jsx)("input",{type:"number",id:"femaleCount",value:x,onChange:e=>b(e.target.value),min:"0",className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Enter female count"})]})]}),(0,n.jsx)("div",{className:"flex justify-center mt-4",children:(0,n.jsx)("button",{onClick:A,disabled:w,className:"".concat(w?"bg-gray-400":"bg-blue-600"," text-white px-6 py-2 rounded-md"),children:w?"Submitting...":"Submit Attendance"})})]}),(0,n.jsxs)("div",{className:"mt-8 bg-white shadow-md rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Attendance Records"}),(0,n.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,n.jsx)("input",{type:"text",placeholder:"Search by any field",value:y,onChange:e=>g(e.target.value),className:"w-full md:w-1/2 p-2 border border-gray-300 rounded-md"})}),D.length>0?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full table-auto border-collapse",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"px-4 py-2 border",children:"Section"}),(0,n.jsx)("th",{className:"px-4 py-2 border",children:"Attendance Date"}),(0,n.jsx)("th",{className:"px-4 py-2 border",children:"Male Count"}),(0,n.jsx)("th",{className:"px-4 py-2 border",children:"Female Count"}),(0,n.jsx)("th",{className:"px-4 py-2 border",children:"Recorded By"})]})}),(0,n.jsx)("tbody",{children:D.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-4 py-2 border",children:e.sectionName}),(0,n.jsx)("td",{className:"px-4 py-2 border",children:new Date(e.attendance_date).toLocaleDateString()}),(0,n.jsx)("td",{className:"px-4 py-2 border",children:e.male_count}),(0,n.jsx)("td",{className:"px-4 py-2 border",children:e.female_count}),(0,n.jsx)("td",{className:"px-4 py-2 border",children:e.teacher_name})]},e.id))})]})}):(0,n.jsx)("p",{children:"No attendance records found."}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,n.jsx)("button",{onClick:()=>q(j-1),disabled:1===j,className:"px-4 py-2 bg-gray-300 rounded-md",children:"Previous"}),(0,n.jsxs)("span",{className:"text-lg font-medium",children:["Page ",j," of ",P]}),(0,n.jsx)("button",{onClick:()=>q(j+1),disabled:j===P,className:"px-4 py-2 bg-gray-300 rounded-md",children:"Next"})]})]})]})})}a(8215)},8215:function(){}},function(e){e.O(0,[166,802,888,774,179],function(){return e(e.s=3090)}),_N_E=e.O()}]);